resource "yandex_vpc_address" "ip-otus-kuber-dev-k8s-ingress" {
  name = "ip-${var.project}-${var.environment}-k8s-ingress"

  external_ipv4_address {
    zone_id = "ru-central1-a"
  }
}

resource "yandex_dns_recordset" "r1-dns-rs-otus-kuber-dev" {
  zone_id = yandex_dns_zone.z1-dns-zone-otus-kuber.id
  name    = "*.${var.subdomain1_1}.${var.domain1}."
  type    = "A"
  ttl     = 600
  data    = ["${yandex_vpc_address.ip-otus-kuber-dev-k8s-ingress.external_ipv4_address.0.address}"]
}

resource "yandex_cm_certificate" "cert-otus-devops-infra-bastion_voytenkov_ru" {
  name    = "cert-${var.project}-${var.environment}-bastion-voytenkov-ru"
  domains = ["*.bastion.voytenkov.ru","bastion.voytenkov.ru"]

  managed {
    challenge_type  = "DNS_CNAME"
    challenge_count = 1
  }
}
